<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Blog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .editor-content { min-height: 300px; }
        .media-preview { max-width: 200px; max-height: 200px; object-fit: cover; }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .max-w-4xl { max-width: 100%; }
            .px-6 { padding-left: 1rem; padding-right: 1rem; }
            .py-8 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
            .py-12 { padding-top: 2rem; padding-bottom: 2rem; }
            .text-3xl { font-size: 1.5rem; line-height: 2rem; }
            .text-2xl { font-size: 1.25rem; line-height: 1.75rem; }
            .space-x-8 > * + * { margin-left: 1rem; }
            .grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            .md\:grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            .md\:grid-cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .flex-col { flex-direction: column; }
            .space-y-4 > * + * { margin-top: 1rem; }
            
            /* Mobile navigation */
            nav { flex-wrap: wrap; gap: 0.5rem; }
            nav button, nav a { font-size: 0.875rem; padding: 0.5rem; }
            
            /* Mobile forms */
            .p-6 { padding: 1rem; }
            .space-y-8 > * + * { margin-top: 1.5rem; }
            
            /* Mobile editor */
            #contentEditor { min-height: 200px; }
            .editor-content { padding: 0.75rem; }
            
            /* Mobile buttons */
            .flex.space-x-4 { flex-direction: column; space: 0; }
            .flex.space-x-4 > * + * { margin-left: 0; margin-top: 0.5rem; }
            .flex.space-x-4 button { width: 100%; }
        }
        
        @media (max-width: 480px) {
            .px-6 { padding-left: 0.75rem; padding-right: 0.75rem; }
            .text-3xl { font-size: 1.25rem; line-height: 1.75rem; }
            .text-2xl { font-size: 1.125rem; line-height: 1.5rem; }
            header .flex { flex-direction: column; align-items: flex-start; gap: 1rem; }
            nav { width: 100%; justify-content: center; }
        }
    </style>
    <style id="customStyles">
        /* Custom styles will be injected here */
    </style>
</head>
<body class="bg-white text-gray-900">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-lg max-w-md w-full mx-4">
            <h2 class="text-2xl font-medium mb-6">Admin Login</h2>
            <div class="space-y-4">
                <input type="password" id="adminPassword" placeholder="Enter admin password" 
                       class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                <button onclick="login()" 
                        class="w-full bg-gray-900 text-white py-3 rounded-lg hover:bg-gray-800 transition-colors">
                    Login
                </button>
                <button onclick="closeLogin()" 
                        class="w-full text-gray-500 hover:text-gray-700 transition-colors">
                    Cancel
                </button>
            </div>
            <p class="text-xs text-gray-500 mt-4">Demo password: admin123</p>
        </div>
    </div>

    <!-- Header -->
    <header class="border-b border-gray-200">
        <div class="max-w-4xl mx-auto px-6 py-8">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-medium">My Blog</h1>
                <nav class="flex space-x-8" id="publicNav">
                    <button onclick="showHome()" class="text-gray-900 hover:text-gray-900 transition-colors" id="homeBtn">Home</button>
                </nav>
                <nav class="flex space-x-8 hidden" id="adminNav">
                    <a href="#" onclick="goToPublic()" class="text-gray-600 hover:text-gray-900 transition-colors">View Blog</a>
                    <button onclick="showEditor()" class="text-gray-600 hover:text-gray-900 transition-colors" id="editorBtn">Write</button>
                    <button onclick="showCustomize()" class="text-gray-600 hover:text-gray-900 transition-colors" id="customizeBtn">Customize</button>
                    <button onclick="logout()" class="text-gray-600 hover:text-gray-900 transition-colors" id="logoutBtn">Logout</button>
                </nav>
            </div>
        </div>
    </header>

    <!-- Public Home View -->
    <main id="homeView" class="max-w-4xl mx-auto px-6 py-12">
        <div id="postsContainer" class="space-y-16">
            <!-- Sample published post -->
            <article class="border-b border-gray-100 pb-16">
                <h2 class="text-3xl font-medium mb-4">Welcome to My Blog</h2>
                <p class="text-gray-600 text-sm mb-6">March 15, 2024</p>
                <div class="prose max-w-none">
                    <p class="text-gray-700 leading-relaxed mb-4">
                        Welcome to my personal blog! This is where I share my thoughts, experiences, and insights on various topics.
                    </p>
                    <p class="text-gray-700 leading-relaxed">
                        Stay tuned for more posts coming soon. Each post is carefully crafted to provide value and spark meaningful conversations.
                    </p>
                </div>
            </article>
        </div>
        
        <!-- Empty state for no posts -->
        <div id="emptyState" class="text-center py-20 hidden">
            <p class="text-gray-500 text-lg">No posts published yet.</p>
            <p class="text-gray-400 text-sm mt-2">Check back soon for new content!</p>
        </div>
    </main>

    <!-- Admin Customize View (Hidden by default) -->
    <div id="customizeView" class="max-w-4xl mx-auto px-6 py-12 hidden">
        <div class="mb-8">
            <h2 class="text-2xl font-medium mb-8">Customize Your Blog</h2>
            
            <!-- Blog Settings -->
            <div class="space-y-8">
                <!-- Blog Title -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Blog Title</h3>
                    <input type="text" id="blogTitle" placeholder="My Blog" 
                           class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                </div>

                <!-- Welcome Post -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Welcome Post</h3>
                    <div class="space-y-4">
                        <input type="text" id="welcomeTitle" placeholder="Welcome to My Blog" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <textarea id="welcomeContent" rows="4" placeholder="Welcome message content..." 
                                  class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500 resize-none"></textarea>
                    </div>
                </div>

                <!-- Navigation Labels -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Navigation Labels</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="homeLabel" placeholder="Home" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="adminLabel" placeholder="Admin" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="writeLabel" placeholder="Write" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="customizeLabel" placeholder="Customize" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                    </div>
                </div>

                <!-- Editor Labels -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Editor Labels</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="writePostLabel" placeholder="Write New Post" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="postTitleLabel" placeholder="Post title..." 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="addPhotosLabel" placeholder="Add Photos" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="uploadPhotosLabel" placeholder="Upload Photos" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="publishLabel" placeholder="Publish Post" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                        <input type="text" id="saveDraftLabel" placeholder="Save Draft" 
                               class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                    </div>
                </div>

                <!-- Header Customization -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Header Styling</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Header Background Color</label>
                            <input type="color" id="headerBgColor" value="#ffffff" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Header Text Color</label>
                            <input type="color" id="headerTextColor" value="#111827" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Header Border Color</label>
                            <input type="color" id="headerBorderColor" value="#e5e7eb" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Navigation Hover Color</label>
                            <input type="color" id="navHoverColor" value="#6b7280" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                </div>

                <!-- Page Styling -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Page Styling</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Background Color</label>
                            <input type="color" id="pageBgColor" value="#ffffff" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Text Color</label>
                            <input type="color" id="pageTextColor" value="#111827" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Link Color</label>
                            <input type="color" id="linkColor" value="#3b82f6" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Button Color</label>
                            <input type="color" id="buttonColor" value="#111827" 
                                   class="w-full h-10 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                </div>

                <!-- Typography -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Typography</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Font Family</label>
                            <select id="fontFamily" class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                                <option value="Inter" style="font-family: Inter;">Inter (Default)</option>
                                <option value="Arial" style="font-family: Arial;">Arial</option>
                                <option value="Georgia" style="font-family: Georgia;">Georgia</option>
                                <option value="Times New Roman" style="font-family: Times New Roman;">Times New Roman</option>
                                <option value="Helvetica" style="font-family: Helvetica;">Helvetica</option>
                                <option value="Verdana" style="font-family: Verdana;">Verdana</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Header Font Size</label>
                            <select id="headerFontSize" class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                                <option value="1.5rem">Small</option>
                                <option value="1.875rem" selected>Medium (Default)</option>
                                <option value="2.25rem">Large</option>
                                <option value="3rem">Extra Large</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Footer Text -->
                <div class="p-6 border border-gray-200 rounded-lg">
                    <h3 class="text-lg font-medium mb-4">Footer Text</h3>
                    <input type="text" id="footerText" placeholder="© 2024 My Blog. Simple and secure." 
                           class="w-full p-3 border border-gray-300 rounded-lg outline-none focus:border-gray-500">
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-4">
                    <button onclick="saveCustomizations()" 
                            class="bg-gray-900 text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                        Save Changes
                    </button>
                    <button onclick="resetCustomizations()" 
                            class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors">
                        Reset to Default
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Editor View (Hidden by default) -->
    <div id="editorView" class="max-w-4xl mx-auto px-6 py-12 hidden">
        <div class="mb-8">
            <h2 class="text-2xl font-medium mb-8">Write New Post</h2>
            
            <!-- Post Title -->
            <div class="mb-6">
                <input type="text" id="postTitle" placeholder="Post title..." 
                       class="w-full text-3xl font-medium border-none outline-none placeholder-gray-400">
            </div>

            <!-- Media Upload Section -->
            <div class="mb-8 p-6 border border-gray-200 rounded-lg">
                <h3 class="text-lg font-medium mb-4">Add Photos</h3>
                <div class="mb-4">
                    <label class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg cursor-pointer transition-colors">
                        <span class="text-sm">Upload Photos</span>
                        <input type="file" id="imageUpload" accept="image/*" multiple class="hidden">
                    </label>
                </div>
                <div id="mediaPreview" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
            </div>

            <!-- Content Editor -->
            <div class="mb-8">
                <div id="contentEditor" contenteditable="true" 
                     class="editor-content w-full p-4 border border-gray-200 rounded-lg outline-none focus:border-gray-400 transition-colors"
                     placeholder="Start writing your post...">
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-4">
                <button onclick="publishPost()" 
                        class="bg-gray-900 text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                    Publish Post
                </button>
                <button onclick="saveDraft()" 
                        class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors">
                    Save Draft
                </button>
                <button onclick="clearEditor()" 
                        class="text-gray-500 hover:text-gray-700 px-6 py-2 transition-colors">
                    Clear
                </button>
            </div>

            <!-- Drafts Section -->
            <div id="draftsSection" class="mt-12 pt-8 border-t border-gray-200">
                <h3 class="text-lg font-medium mb-4">Your Drafts</h3>
                <div id="draftsContainer" class="space-y-4">
                    <!-- Drafts will appear here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-gray-200 mt-20">
        <div class="max-w-4xl mx-auto px-6 py-8">
            <p class="text-gray-500 text-sm text-center">© 2024 My Blog. Simple and secure.</p>
        </div>
    </footer>

    <script>
        let posts = [];
        let drafts = [];
        let uploadedMedia = [];
        let isLoggedIn = false;
        const adminPassword = 'admin123'; // In real use, this would be handled server-side

        // Cloud Storage Simulation (using a simple cloud storage approach)
        const STORAGE_KEY = 'myBlogData_' + window.location.hostname;
        
        function saveToCloudStorage() {
            const blogData = {
                posts: posts,
                drafts: drafts,
                customizations: customizations,
                timestamp: Date.now()
            };
            
            // Save to localStorage (simulating cloud storage)
            localStorage.setItem(STORAGE_KEY, JSON.stringify(blogData));
            
            // Also save to sessionStorage for cross-tab sync
            sessionStorage.setItem(STORAGE_KEY, JSON.stringify(blogData));
            
            // Broadcast to other tabs/windows
            window.dispatchEvent(new CustomEvent('blogDataUpdated', { detail: blogData }));
        }

        function loadFromCloudStorage() {
            // Try to load from localStorage first
            let savedData = localStorage.getItem(STORAGE_KEY);
            
            // If not found, try sessionStorage
            if (!savedData) {
                savedData = sessionStorage.getItem(STORAGE_KEY);
            }
            
            if (savedData) {
                try {
                    const blogData = JSON.parse(savedData);
                    posts = blogData.posts || [];
                    drafts = blogData.drafts || [];
                    customizations = { ...customizations, ...(blogData.customizations || {}) };
                } catch (e) {
                    console.log('Error loading blog data:', e);
                }
            }
        }
        
        // Listen for data updates from other tabs
        window.addEventListener('blogDataUpdated', function(e) {
            const blogData = e.detail;
            posts = blogData.posts || [];
            drafts = blogData.drafts || [];
            customizations = { ...customizations, ...(blogData.customizations || {}) };
            renderPublicPosts();
            applyCustomizations();
        });
        
        // Sync data when window gains focus (for cross-browser sync)
        window.addEventListener('focus', function() {
            loadFromCloudStorage();
            renderPublicPosts();
            applyCustomizations();
            if (isLoggedIn) {
                renderDrafts();
            }
        });

        // Customization settings with defaults
        let customizations = {
            blogTitle: 'My Blog',
            welcomeTitle: 'Welcome to My Blog',
            welcomeContent: 'Welcome to my personal blog! This is where I share my thoughts, experiences, and insights on various topics.\n\nStay tuned for more posts coming soon. Each post is carefully crafted to provide value and spark meaningful conversations.',
            homeLabel: 'Home',
            adminLabel: 'Admin',
            writeLabel: 'Write',
            customizeLabel: 'Customize',
            writePostLabel: 'Write New Post',
            postTitleLabel: 'Post title...',
            addPhotosLabel: 'Add Photos',
            uploadPhotosLabel: 'Upload Photos',
            publishLabel: 'Publish Post',
            saveDraftLabel: 'Save Draft',
            footerText: '© 2024 My Blog. Simple and secure.',
            // Styling options
            headerBgColor: '#ffffff',
            headerTextColor: '#111827',
            headerBorderColor: '#e5e7eb',
            navHoverColor: '#6b7280',
            pageBgColor: '#ffffff',
            pageTextColor: '#111827',
            linkColor: '#3b82f6',
            buttonColor: '#111827',
            fontFamily: 'Inter',
            headerFontSize: '1.875rem'
        };

        // URL Routing
        function updateURL(path) {
            window.history.pushState({}, '', path);
        }

        function handleURLChange() {
            const path = window.location.hash || window.location.pathname;
            
            if (path.includes('admin')) {
                if (!isLoggedIn) {
                    showLogin();
                } else {
                    showAdminInterface();
                    showEditor();
                }
            } else {
                showPublicInterface();
                showHome();
            }
        }

        function goToAdmin() {
            updateURL('#admin');
            if (!isLoggedIn) {
                showLogin();
            } else {
                showAdminInterface();
                showEditor();
            }
        }

        function goToPublic() {
            updateURL('#');
            if (isLoggedIn) {
                // Keep admin logged in but show public view
                document.getElementById('publicNav').classList.remove('hidden');
                document.getElementById('adminNav').classList.add('hidden');
            } else {
                showPublicInterface();
            }
            showHome();
        }

        // Authentication
        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('adminPassword').value = '';
        }

        function login() {
            const password = document.getElementById('adminPassword').value;
            if (password === adminPassword) {
                isLoggedIn = true;
                closeLogin();
                updateURL('#admin');
                showAdminInterface();
                showEditor();
                alert('Welcome back! You can now create and manage posts.');
            } else {
                alert('Incorrect password. Please try again.');
            }
        }

        function logout() {
            isLoggedIn = false;
            updateURL('#');
            showPublicInterface();
            showHome();
            alert('Logged out successfully.');
        }

        function showAdminInterface() {
            document.getElementById('publicNav').classList.add('hidden');
            document.getElementById('adminNav').classList.remove('hidden');
        }

        function showPublicInterface() {
            document.getElementById('publicNav').classList.remove('hidden');
            document.getElementById('adminNav').classList.add('hidden');
        }

        // Navigation
        function showHome() {
            document.getElementById('homeView').classList.remove('hidden');
            document.getElementById('editorView').classList.add('hidden');
            document.getElementById('customizeView').classList.add('hidden');
            updateNavigation('home');
        }

        function showEditor() {
            if (!isLoggedIn) {
                showLogin();
                return;
            }
            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('editorView').classList.remove('hidden');
            document.getElementById('customizeView').classList.add('hidden');
            updateNavigation('editor');
            renderDrafts();
        }

        function showCustomize() {
            if (!isLoggedIn) {
                showLogin();
                return;
            }
            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('editorView').classList.add('hidden');
            document.getElementById('customizeView').classList.remove('hidden');
            updateNavigation('customize');
            loadCustomizationForm();
        }

        function updateNavigation(active) {
            // Reset all buttons
            document.getElementById('homeBtn').classList.remove('text-gray-900');
            document.getElementById('homeBtn').classList.add('text-gray-600');
            if (document.getElementById('editorBtn').classList.contains('hidden') === false) {
                document.getElementById('editorBtn').classList.remove('text-gray-900');
                document.getElementById('editorBtn').classList.add('text-gray-600');
            }
            if (document.getElementById('customizeBtn').classList.contains('hidden') === false) {
                document.getElementById('customizeBtn').classList.remove('text-gray-900');
                document.getElementById('customizeBtn').classList.add('text-gray-600');
            }

            // Highlight active button
            if (active === 'home') {
                document.getElementById('homeBtn').classList.add('text-gray-900');
                document.getElementById('homeBtn').classList.remove('text-gray-600');
            } else if (active === 'editor') {
                document.getElementById('editorBtn').classList.add('text-gray-900');
                document.getElementById('editorBtn').classList.remove('text-gray-600');
            } else if (active === 'customize') {
                document.getElementById('customizeBtn').classList.add('text-gray-900');
                document.getElementById('customizeBtn').classList.remove('text-gray-600');
            }
        }

        // Media Upload Handling
        document.getElementById('imageUpload').addEventListener('change', function(e) {
            handleMediaUpload(e.target.files);
        });

        function handleMediaUpload(files) {
            const preview = document.getElementById('mediaPreview');
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mediaData = {
                        src: e.target.result,
                        name: file.name
                    };
                    uploadedMedia.push(mediaData);
                    
                    const mediaElement = document.createElement('div');
                    mediaElement.className = 'relative group';
                    mediaElement.innerHTML = `
                        <img src="${e.target.result}" class="media-preview rounded-lg" alt="${file.name}">
                        <button onclick="removeMedia(${uploadedMedia.length - 1})" 
                                class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 text-xs opacity-0 group-hover:opacity-100 transition-opacity">×</button>
                    `;
                    
                    preview.appendChild(mediaElement);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeMedia(index) {
            uploadedMedia.splice(index, 1);
            updateMediaPreview();
        }

        function updateMediaPreview() {
            const preview = document.getElementById('mediaPreview');
            preview.innerHTML = '';
            
            uploadedMedia.forEach((media, index) => {
                const mediaElement = document.createElement('div');
                mediaElement.className = 'relative group';
                mediaElement.innerHTML = `
                    <img src="${media.src}" class="media-preview rounded-lg" alt="${media.name}">
                    <button onclick="removeMedia(${index})" 
                            class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 text-xs opacity-0 group-hover:opacity-100 transition-opacity">×</button>
                `;
                preview.appendChild(mediaElement);
            });
        }

        // Editor placeholder handling
        const editor = document.getElementById('contentEditor');
        editor.addEventListener('focus', function() {
            if (this.innerHTML === '') {
                this.innerHTML = '';
            }
        });

        // Post Management
        let editingPostId = null;
        
        function publishPost() {
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('contentEditor').innerHTML.trim();
            
            if (!title || !content) {
                alert('Please add a title and content for your post.');
                return;
            }

            if (editingPostId) {
                // Update existing post
                const postIndex = posts.findIndex(p => p.id === editingPostId);
                if (postIndex !== -1) {
                    posts[postIndex] = {
                        ...posts[postIndex],
                        title: title,
                        content: content,
                        media: [...uploadedMedia],
                        lastModified: new Date().toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        })
                    };
                    alert('Post updated successfully!');
                }
                editingPostId = null;
            } else {
                // Create new post
                const post = {
                    id: Date.now(),
                    title: title,
                    content: content,
                    media: [...uploadedMedia],
                    date: new Date().toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })
                };
                posts.unshift(post);
                alert('Post published successfully! Visitors can now see it.');
            }

            saveToCloudStorage();
            renderPublicPosts();
            clearEditor();
            showHome();
        }
        
        function editPost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            editingPostId = postId;
            
            // Load post data into editor
            document.getElementById('postTitle').value = post.title;
            document.getElementById('contentEditor').innerHTML = post.content;
            uploadedMedia = [...(post.media || [])];
            updateMediaPreview();
            
            // Update button text
            document.querySelector('button[onclick="publishPost()"]').textContent = 'Update Post';
            
            // Switch to editor view
            showEditor();
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        function saveDraft() {
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('contentEditor').innerHTML.trim();
            
            if (!title && !content) {
                alert('Nothing to save.');
                return;
            }

            const draft = {
                id: Date.now(),
                title: title || 'Untitled Draft',
                content: content,
                media: [...uploadedMedia],
                date: new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })
            };

            drafts.unshift(draft);
            saveToCloudStorage();
            renderDrafts();
            alert('Draft saved successfully!');
        }

        function loadDraft(draftId) {
            const draft = drafts.find(d => d.id === draftId);
            if (draft) {
                document.getElementById('postTitle').value = draft.title;
                document.getElementById('contentEditor').innerHTML = draft.content;
                uploadedMedia = [...draft.media];
                updateMediaPreview();
                
                // Remove draft from drafts array
                drafts = drafts.filter(d => d.id !== draftId);
                renderDrafts();
            }
        }

        function deleteDraft(draftId) {
            if (confirm('Are you sure you want to delete this draft?')) {
                drafts = drafts.filter(d => d.id !== draftId);
                saveToCloudStorage();
                renderDrafts();
            }
        }

        function clearEditor() {
            document.getElementById('postTitle').value = '';
            document.getElementById('contentEditor').innerHTML = '';
            uploadedMedia = [];
            document.getElementById('mediaPreview').innerHTML = '';
            editingPostId = null;
            
            // Reset button text
            document.querySelector('button[onclick="publishPost()"]').textContent = customizations.publishLabel || 'Publish Post';
        }

        function renderPublicPosts() {
            const container = document.getElementById('postsContainer');
            const emptyState = document.getElementById('emptyState');
            
            // Always show the welcome post first, then add published posts
            const welcomeContentFormatted = customizations.welcomeContent.replace(/\n/g, '</p><p class="text-gray-700 leading-relaxed mb-4">');
            container.innerHTML = `
                <article class="border-b border-gray-100 pb-16">
                    <h2 class="text-3xl font-medium mb-4">${customizations.welcomeTitle}</h2>
                    <p class="text-gray-600 text-sm mb-6">March 15, 2024</p>
                    <div class="prose max-w-none">
                        <p class="text-gray-700 leading-relaxed mb-4">
                            ${welcomeContentFormatted}
                        </p>
                    </div>
                </article>
            `;
            
            // Add published posts
            posts.forEach(post => {
                const article = document.createElement('article');
                article.className = 'border-b border-gray-100 pb-16 relative';
                
                let mediaHTML = '';
                if (post.media.length > 0) {
                    mediaHTML = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">';
                    post.media.forEach(media => {
                        mediaHTML += `<img src="${media.src}" class="rounded-lg w-full" alt="${media.name}">`;
                    });
                    mediaHTML += '</div>';
                }
                
                // Add edit button for admin users
                let editButtonHTML = '';
                if (isLoggedIn) {
                    editButtonHTML = `
                        <div class="absolute top-0 right-0">
                            <button onclick="editPost(${post.id})" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded-lg transition-colors">
                                Edit Post
                            </button>
                        </div>
                    `;
                }
                
                article.innerHTML = `
                    ${editButtonHTML}
                    <h2 class="text-3xl font-medium mb-4">${post.title}</h2>
                    <p class="text-gray-600 text-sm mb-6">${post.date}</p>
                    ${mediaHTML}
                    <div class="prose max-w-none">
                        ${post.content}
                    </div>
                `;
                
                container.appendChild(article);
            });
            
            // Hide empty state since we always have at least the welcome post
            emptyState.classList.add('hidden');
        }

        function renderDrafts() {
            const container = document.getElementById('draftsContainer');
            
            if (drafts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No drafts saved.</p>';
                return;
            }
            
            container.innerHTML = '';
            
            drafts.forEach(draft => {
                const draftElement = document.createElement('div');
                draftElement.className = 'p-4 border border-gray-200 rounded-lg';
                draftElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="font-medium">${draft.title}</h4>
                            <p class="text-sm text-gray-500 mt-1">${draft.date}</p>
                        </div>
                        <div class="flex space-x-2 ml-4">
                            <button onclick="loadDraft(${draft.id})" 
                                    class="text-blue-600 hover:text-blue-700 text-sm">
                                Edit
                            </button>
                            <button onclick="deleteDraft(${draft.id})" 
                                    class="text-red-600 hover:text-red-700 text-sm">
                                Delete
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(draftElement);
            });
        }

        // Handle Enter key in password field
        document.getElementById('adminPassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        // Customization Functions
        function loadCustomizationForm() {
            document.getElementById('blogTitle').value = customizations.blogTitle;
            document.getElementById('welcomeTitle').value = customizations.welcomeTitle;
            document.getElementById('welcomeContent').value = customizations.welcomeContent;
            document.getElementById('homeLabel').value = customizations.homeLabel;
            document.getElementById('adminLabel').value = customizations.adminLabel;
            document.getElementById('writeLabel').value = customizations.writeLabel;
            document.getElementById('customizeLabel').value = customizations.customizeLabel;
            document.getElementById('writePostLabel').value = customizations.writePostLabel;
            document.getElementById('postTitleLabel').value = customizations.postTitleLabel;
            document.getElementById('addPhotosLabel').value = customizations.addPhotosLabel;
            document.getElementById('uploadPhotosLabel').value = customizations.uploadPhotosLabel;
            document.getElementById('publishLabel').value = customizations.publishLabel;
            document.getElementById('saveDraftLabel').value = customizations.saveDraftLabel;
            document.getElementById('footerText').value = customizations.footerText;
            
            // Load styling options
            document.getElementById('headerBgColor').value = customizations.headerBgColor;
            document.getElementById('headerTextColor').value = customizations.headerTextColor;
            document.getElementById('headerBorderColor').value = customizations.headerBorderColor;
            document.getElementById('navHoverColor').value = customizations.navHoverColor;
            document.getElementById('pageBgColor').value = customizations.pageBgColor;
            document.getElementById('pageTextColor').value = customizations.pageTextColor;
            document.getElementById('linkColor').value = customizations.linkColor;
            document.getElementById('buttonColor').value = customizations.buttonColor;
            document.getElementById('fontFamily').value = customizations.fontFamily;
            document.getElementById('headerFontSize').value = customizations.headerFontSize;
        }

        function saveCustomizations() {
            customizations.blogTitle = document.getElementById('blogTitle').value || 'My Blog';
            customizations.welcomeTitle = document.getElementById('welcomeTitle').value || 'Welcome to My Blog';
            customizations.welcomeContent = document.getElementById('welcomeContent').value || 'Welcome to my personal blog!';
            customizations.homeLabel = document.getElementById('homeLabel').value || 'Home';
            customizations.adminLabel = document.getElementById('adminLabel').value || 'Admin';
            customizations.writeLabel = document.getElementById('writeLabel').value || 'Write';
            customizations.customizeLabel = document.getElementById('customizeLabel').value || 'Customize';
            customizations.writePostLabel = document.getElementById('writePostLabel').value || 'Write New Post';
            customizations.postTitleLabel = document.getElementById('postTitleLabel').value || 'Post title...';
            customizations.addPhotosLabel = document.getElementById('addPhotosLabel').value || 'Add Photos';
            customizations.uploadPhotosLabel = document.getElementById('uploadPhotosLabel').value || 'Upload Photos';
            customizations.publishLabel = document.getElementById('publishLabel').value || 'Publish Post';
            customizations.saveDraftLabel = document.getElementById('saveDraftLabel').value || 'Save Draft';
            customizations.footerText = document.getElementById('footerText').value || '© 2024 My Blog. Simple and secure.';
            
            // Save styling options
            customizations.headerBgColor = document.getElementById('headerBgColor').value;
            customizations.headerTextColor = document.getElementById('headerTextColor').value;
            customizations.headerBorderColor = document.getElementById('headerBorderColor').value;
            customizations.navHoverColor = document.getElementById('navHoverColor').value;
            customizations.pageBgColor = document.getElementById('pageBgColor').value;
            customizations.pageTextColor = document.getElementById('pageTextColor').value;
            customizations.linkColor = document.getElementById('linkColor').value;
            customizations.buttonColor = document.getElementById('buttonColor').value;
            customizations.fontFamily = document.getElementById('fontFamily').value;
            customizations.headerFontSize = document.getElementById('headerFontSize').value;
            
            applyCustomizations();
            saveToCloudStorage();
            alert('Customizations saved successfully!');
            showHome();
        }

        function resetCustomizations() {
            if (confirm('Are you sure you want to reset all customizations to default?')) {
                customizations = {
                    blogTitle: 'My Blog',
                    welcomeTitle: 'Welcome to My Blog',
                    welcomeContent: 'Welcome to my personal blog! This is where I share my thoughts, experiences, and insights on various topics.\n\nStay tuned for more posts coming soon. Each post is carefully crafted to provide value and spark meaningful conversations.',
                    homeLabel: 'Home',
                    adminLabel: 'Admin',
                    writeLabel: 'Write',
                    customizeLabel: 'Customize',
                    writePostLabel: 'Write New Post',
                    postTitleLabel: 'Post title...',
                    addPhotosLabel: 'Add Photos',
                    uploadPhotosLabel: 'Upload Photos',
                    publishLabel: 'Publish Post',
                    saveDraftLabel: 'Save Draft',
                    footerText: '© 2024 My Blog. Simple and secure.',
                    // Reset styling options
                    headerBgColor: '#ffffff',
                    headerTextColor: '#111827',
                    headerBorderColor: '#e5e7eb',
                    navHoverColor: '#6b7280',
                    pageBgColor: '#ffffff',
                    pageTextColor: '#111827',
                    linkColor: '#3b82f6',
                    buttonColor: '#111827',
                    fontFamily: 'Inter',
                    headerFontSize: '1.875rem'
                };
                loadCustomizationForm();
                applyCustomizations();
                alert('Customizations reset to default!');
            }
        }

        function applyCustomizations() {
            // Update blog title
            document.querySelector('h1').textContent = customizations.blogTitle;
            document.title = customizations.blogTitle;
            
            // Update navigation labels
            document.getElementById('homeBtn').textContent = customizations.homeLabel;
            document.getElementById('editorBtn').textContent = customizations.writeLabel;
            document.getElementById('customizeBtn').textContent = customizations.customizeLabel;
            
            // Update editor labels
            document.querySelector('#editorView h2').textContent = customizations.writePostLabel;
            document.getElementById('postTitle').placeholder = customizations.postTitleLabel;
            document.querySelector('#editorView h3').textContent = customizations.addPhotosLabel;
            document.querySelector('label span').textContent = customizations.uploadPhotosLabel;
            document.querySelector('button[onclick="publishPost()"]').textContent = customizations.publishLabel;
            document.querySelector('button[onclick="saveDraft()"]').textContent = customizations.saveDraftLabel;
            
            // Update footer
            document.querySelector('footer p').textContent = customizations.footerText;
            
            // Apply custom styles
            const customStylesElement = document.getElementById('customStyles');
            customStylesElement.innerHTML = `
                body {
                    background-color: ${customizations.pageBgColor} !important;
                    color: ${customizations.pageTextColor} !important;
                    font-family: '${customizations.fontFamily}', sans-serif !important;
                }
                
                header {
                    background-color: ${customizations.headerBgColor} !important;
                    border-bottom-color: ${customizations.headerBorderColor} !important;
                }
                
                header h1 {
                    color: ${customizations.headerTextColor} !important;
                    font-size: ${customizations.headerFontSize} !important;
                }
                
                nav button, nav a {
                    color: ${customizations.headerTextColor} !important;
                }
                
                nav button:hover, nav a:hover {
                    color: ${customizations.navHoverColor} !important;
                }
                
                .text-gray-900 {
                    color: ${customizations.headerTextColor} !important;
                }
                
                .text-gray-600 {
                    color: ${customizations.navHoverColor} !important;
                }
                
                .text-gray-700 {
                    color: ${customizations.pageTextColor} !important;
                }
                
                .text-gray-500 {
                    color: ${customizations.navHoverColor} !important;
                }
                
                a {
                    color: ${customizations.linkColor} !important;
                }
                
                .bg-gray-900 {
                    background-color: ${customizations.buttonColor} !important;
                }
                
                .bg-gray-800 {
                    background-color: ${customizations.buttonColor}dd !important;
                }
                
                .border-gray-200 {
                    border-color: ${customizations.headerBorderColor} !important;
                }
                
                .border-gray-100 {
                    border-color: ${customizations.headerBorderColor}80 !important;
                }
                
                article h2 {
                    color: ${customizations.pageTextColor} !important;
                }
                
                .prose p {
                    color: ${customizations.pageTextColor} !important;
                }
                
                footer {
                    border-top-color: ${customizations.headerBorderColor} !important;
                    background-color: ${customizations.headerBgColor} !important;
                }
                
                footer p {
                    color: ${customizations.navHoverColor} !important;
                }
                
                #loginModal .bg-white {
                    background-color: ${customizations.headerBgColor} !important;
                }
                
                #customizeView, #editorView {
                    color: ${customizations.pageTextColor} !important;
                }
                
                input, textarea, select {
                    background-color: ${customizations.pageBgColor} !important;
                    color: ${customizations.pageTextColor} !important;
                    border-color: ${customizations.headerBorderColor} !important;
                }
                
                input:focus, textarea:focus, select:focus {
                    border-color: ${customizations.navHoverColor} !important;
                }
                
                .bg-gray-100 {
                    background-color: ${customizations.headerBorderColor}40 !important;
                }
                
                .bg-gray-200 {
                    background-color: ${customizations.headerBorderColor}60 !important;
                }
            `;
            
            // Re-render posts to apply welcome post changes
            renderPublicPosts();
        }

        // Initialize
        window.addEventListener('popstate', handleURLChange);
        window.addEventListener('load', function() {
            loadFromCloudStorage();
            handleURLChange();
        });
        
        // Default initialization
        if (!window.location.hash) {
            loadFromCloudStorage();
            showHome();
            renderPublicPosts();
            applyCustomizations();
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96545c2bf626fdb0',t:'MTc1MzUzNzc2My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
